/*---------------------------------------------------------------
  0. SCANLINE OVERLAY  –  (unchanged from project where possible)
----------------------------------------------------------------*/
.app-container {
  position: relative;
  min-height: 100vh;              /* allow tall results */
  overflow: hidden;
  margin-left: var(--nav-width);

  background-image: linear-gradient(
    175deg,
    var(--accent-color) -200%,
    rgba(13, 15, 17, 1) 25%
  );
  background-attachment: fixed;
  background-size: cover;
}
.app-container::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-size: 1024px 1024px;
  background: radial-gradient(
    circle at 68% 16%,
    rgba(114, 105, 221, 0.08) 0%,
    rgba(11, 21, 158, 0) 35%
  );
  z-index: 4000;
}
.app-container::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-image:
    url('/assets/images/white_noise_overlay.png'),
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,.06) 0px,
      rgba(255,255,255,.06) 3px,
      transparent 3px,
      transparent 6px
    );
  mix-blend-mode: soft-light;
  z-index: 5000; /* above vignette but below nav */
}
@media (max-width: 768px) {
  .app-container {
    margin-left: 0;
    padding-top: var(--btn-size-mobile);
    min-height: calc(100dvh - var(--btn-size-mobile));
    background-attachment: scroll;
  }
  .app-container::before { background: transparent; mix-blend-mode: normal; }
}

/* utility */
.hidden { display: none !important; }
.sr-only {
  position: absolute !important;
  width: 1px; height: 1px; padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
}

/*---------------------------------------------------------------
  1. MAIN WRAPPER — flex, with responsive column stack
----------------------------------------------------------------*/
.search-main {
  display: flex;
  gap: clamp(4px, 0.5vw, 8px);
  max-width: min(1600px, 96vw);
  margin-inline: auto;
  padding: clamp(12px, 1.5vw, 20px);
  align-items: flex-start;
  justify-content: center;
}
.search-controls {
  flex: 0 0 clamp(360px, 28vw, 440px);
  width: clamp(360px, 28vw, 440px);
  padding: var(--spacing-md);
  container-type: inline-size;    /* enables chip container queries */
}
.search-results {
  flex: 1 1 auto;
  min-width: 0;                   /* fix flex overflow in Safari/Chrome */
  padding: var(--spacing-md);
}
@media (max-width: 980px) {
  .search-main {
    flex-direction: column;
  }
  .search-controls,
  .search-results {
    box-sizing: border-box;
    width: 100%;
    flex: 1 1 auto;
    padding: var(--spacing-md);
  }
}

/*---------------------------------------------------------------
  2. CONTROLS PANEL  (glow wrapper + cut-corner inner plate)
----------------------------------------------------------------*/
.search-controls__title {
  font-family: Consolas, monospace;
  font-size: clamp(1.25rem, 1.2vw + .9rem, 2rem);
  font-weight: 700;
  letter-spacing: .02em;
  text-align: left;
  margin: 0 0 var(--spacing-md) 0;
  text-shadow: 0 0 6px rgba(0, 255, 255, .25);
  position: relative;
}
/* accent baseline under title */
.search-controls__title::after {
  content: '';
  display: block;
  width: min(420px, 60%);
  height: 2px;
  margin-top: .35rem;
  background: linear-gradient(
    90deg,
    var(--accent-color) 0%,
    var(--words-color) 50%,
    transparent 100%
  );
}

.search-controls__form-wrapper {
  position: relative;
  filter:
    drop-shadow(1px 0 0 var(--accent-color))
    drop-shadow(-1px 0 0 var(--accent-color))
    drop-shadow(0 1px 0 var(--accent-color))
    drop-shadow(0 -1px 0 var(--accent-color))
    drop-shadow(0 0 10px rgba(var(--accent), .3));
  -webkit-filter:
    drop-shadow(1px 0 0 var(--accent-color))
    drop-shadow(-1px 0 0 var(--accent-color))
    drop-shadow(0 1px 0 var(--accent-color))
    drop-shadow(0 -1px 0 var(--accent-color))
    drop-shadow(0 0 10px rgba(var(--accent), .3));
}

/* inner plate */
.search-controls__form {
  position: relative;
  padding: var(--spacing-lg);
  background: rgba(13, 15, 17, .95);
  clip-path: polygon(0 0, 0 96%, 2% 100%, 98.5% 100%, 100% 98%, 100% 3%, 90% 3%, 85% 0);
  -webkit-clip-path: polygon(0 0, 0 96%, 2% 100%, 98.5% 100%, 100% 98%, 100% 3%, 90% 3%, 85% 0);

  /* FLEX LAYOUT */
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--spacing-md);
}
.search-controls__form::after {
  content: '';
  position: absolute; inset: -1px;
  clip-path: inherit; pointer-events: none; z-index: -1;
  mix-blend-mode: screen; opacity: .3;
}
.search-controls__form::before {
  content: '';
  position: absolute; inset: 0;
  clip-path: inherit; pointer-events: none;
  background:
    repeating-linear-gradient(to right, rgba(255,255,255,.02) 0 1px, transparent 1px 44px),
    repeating-linear-gradient(to bottom, rgba(255,255,255,.02) 0 1px, transparent 1px 44px);
  mask: linear-gradient(#000, transparent 85%);
}

/* children default to full width; override per-control below */
.search-controls__form > * { flex: 1 1 100%; }

.search-controls label { color: rgba(255,255,255,.85); letter-spacing: .06em; }

/* inputs */
.search-controls__select,
.search-controls__input,
#advanced-search input[type="text"] {
  font-family: 'Yu Gothic','Meiryo','Hiragino Kaku Gothic ProN','Noto Sans JP',sans-serif;
  box-sizing: border-box; width: 100%;
  padding: .85rem .9rem .85rem .8rem;
  border: 1.5px solid #44485a; border-radius: 8px;
  background: #23243a; color: #fff; font-size: 1rem; outline: none;
  transition: border-color .15s, box-shadow .15s, background .2s;
  caret-color: var(--accent-color);
}
.search-controls__select:hover,
.search-controls__input:hover,
#advanced-search input[type="text"]:hover { border-color: rgba(var(--accent), .5); }
.search-controls__select:focus,
.search-controls__input:focus,
#advanced-search input[type="text"] :focus {
  border-color: var(--accent-color);
  box-shadow: 0 0 0 3px rgba(var(--accent), .22), 0 0 18px rgba(var(--accent), .25);
  background: #252744;
}
.search-controls__input::placeholder { color: #b0b2c3; opacity: 1; }

/* modes occupy a full row */
.search-mode, .mode-switch { flex: 1 1 100%; }

/* buttons row (right-aligned on one line) */
.search-controls__toggle,
.search-controls__button {
  flex: 0 0 auto;
  height: 2.6rem;
  align-self: center;
}
.search-controls__toggle { margin-left: auto; }       /* pushes actions to the right */
.search-controls__button { margin-left: .5rem; }

/* ghost toggle */
.search-controls__toggle {
  padding: 0 .9rem;
  border: 1px solid rgba(var(--accent), .55);
  background: rgba(0,0,0,.25); color: var(--accent-color);
  border-radius: 6px; letter-spacing: .02em; cursor: pointer;
  transition: background .15s, border-color .15s, color .15s, transform .05s;
}
.search-controls__toggle:hover { background: rgba(0,0,0,.35); border-color: var(--accent-color); color: var(--text-color); }
.search-controls__toggle:active { transform: translateY(1px); }
.search-controls__toggle:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--accent), .22); }

/* primary search button */
.search-controls__button {
  --background-color: rgb(15, 15, 19);
  --border-color: linear-gradient(to bottom right, var(--accent-color), var(--accent-color));
  --border-width: .1em; --edge-size: .5em;
  position: relative; isolation: isolate; cursor: pointer;
  padding: 0 .95rem;
  color: var(--accent-color); font-weight: 700; letter-spacing: .02em;
  border: 0; background: var(--background-color);
  clip-path: polygon(var(--edge-size) 0%, 100% 0, 100% calc(100% - var(--edge-size)), calc(100% - var(--edge-size)) 100%, 0 100%, 0% var(--edge-size));
  transition: color .05s, transform .05s;
}
.search-controls__button::before { content: ''; position: absolute; inset: 0; background: var(--border-color); z-index: -2; transition: filter .2s; }
.search-controls__button::after  { content: ''; position: absolute; inset: 0; background: var(--background-color); z-index: -1; clip-path: polygon(var(--border-width) calc(var(--edge-size) + var(--border-width) * .5), calc(var(--edge-size) + var(--border-width) * .5) var(--border-width), calc(100% - var(--border-width)) var(--border-width), calc(100% - var(--border-width)) calc(100% - calc(var(--edge-size) + var(--border-width) * .5)), calc(100% - calc(var(--edge-size) + var(--border-width) * .5)) calc(100% - var(--border-width)), calc(var(--border-width)) calc(100% - var(--border-width))); }
.search-controls__button:hover { color: var(--text-color); transform: translateY(-1px); }
.search-controls__button:hover::before { background: linear-gradient(to bottom right, var(--accent-color), var(--words-color)); filter: brightness(1.25); }
.search-controls__button:active { transform: translateY(0); }
.search-controls__button:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--accent), .22); }

/*---------------------------------------------------------------
  2a. DATARAIL MODE SWITCH — cyberpunk interactive selector
----------------------------------------------------------------*/
.search-controls label[for="search-type"] { align-self: flex-end; flex: 1 1 100%; font-family: Consolas, monospace; }

.mode-switch {
  position: relative;
  display: grid;
  grid-template-columns: repeat(6, minmax(0, 1fr));
  gap: 10px;
  padding: 12px; border-radius: 12px;
  background: linear-gradient(180deg, rgba(var(--accent), .06), rgba(255, 63, 180, .04));
  border: 1px solid rgba(var(--accent), .35);
  box-shadow: inset 0 0 0 1px rgba(255, 63, 180, .08);
  max-width: 100%;
}
.mode-switch input[type="radio"] { position: absolute; inset: auto; opacity: 0; pointer-events: none; }

.mode-chip {
  --chip: var(--accent-color);
  min-width: 0; box-sizing: border-box;
  position: relative; display: grid; grid-template-rows: auto auto; align-content: center; gap: 2px;
  padding: 12px 10px; border-radius: 12px; cursor: pointer;
  background: linear-gradient(180deg, #0b1426, #0a1222);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.3);
  transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease, background 140ms ease, filter 140ms ease;
}
.mode-chip:hover { transform: translateY(-1px); filter: brightness(1.06); }
.mode-chip:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--accent), .45); }
.chip-key { font-size: clamp(10px, .7vw, 12px); padding: 2px 6px; display: none; }
.chip-jp  { font-weight: 700; line-height: 1.2; font-size: clamp(13px, .95vw, 20px); }
.chip-en  { font-size: clamp(8px, .8vw, 10px); color: #8fa0c2; letter-spacing: .1em;
            text-transform: uppercase; min-width: 0; overflow: hidden; text-overflow: ellipsis; }

/* per-option hues */
.mode-chip[data-color="radicals"]   { --chip: var(--radicals-color); }
.mode-chip[data-color="kanji"]      { --chip: var(--kanji-color); }
.mode-chip[data-color="words"]      { --chip: var(--words-color); }
.mode-chip[data-color="yojijukugo"] { --chip: var(--yojijukugo-color); }
.mode-chip[data-color="kotowaza"]   { --chip: var(--kotowaza-color); }
.mode-chip[data-color="sentences"]  { --chip: var(--sentences-color); }

/* active state via hidden radios */
#mode-radicals:checked   + label[for="mode-radicals"],
#mode-kanji:checked      + label[for="mode-kanji"],
#mode-words:checked      + label[for="mode-words"],
#mode-yojijukugo:checked + label[for="mode-yojijukugo"],
#mode-kotowaza:checked   + label[for="mode-kotowaza"],
#mode-sentences:checked  + label[for="mode-sentences"] {
  border-color: rgba(255, 255, 255, 0.18);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.12),
    0 0 12px var(--chip),
    0 0 24px color-mix(in srgb, var(--chip) 30%, transparent);
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.05));
}

/* top streak on each chip */
.mode-chip::after {
  content: "";
  position: absolute; left: 8px; right: 8px; top: 6px;
  height: 2px; border-radius: 2px;
  background: linear-gradient(90deg, var(--chip), transparent 70%);
  opacity: .55;
}

/* neon underline cursor (transition enabled after first paint) */
.mode-cursor {
  position: absolute; top: 8px; left: 0;
  height: 3px; width: 0; border-radius: 8px;
  background: var(--accent-color);
  box-shadow:
    0 0 10px var(--accent-color),
    0 0 22px color-mix(in srgb, var(--accent-color) 60%, transparent);
  transition:
    transform 360ms cubic-bezier(.22,.8,.26,1),
    width 360ms cubic-bezier(.22,.8,.26,1),
    background-color 120ms ease,
    box-shadow 120ms ease;
  will-change: transform, width;
}
.mode-switch[data-animate="1"] .mode-cursor {
  transition:
    transform 320ms cubic-bezier(.2,.8,.2,1),
    width 320ms cubic-bezier(.2,.8,.2,1),
    background-color 120ms ease,
    box-shadow 120ms ease;
}

/* Prevent chip overflow + responsive */
@container (max-width: 820px) {

  .mode-chip { padding: 10px 8px; }
}
@container (max-width: 560px) {
  .mode-switch { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}

/*---------------------------------------------------------------
  2b. ADVANCED SEARCH FIELDS (single, non-duplicated block)
----------------------------------------------------------------*/
#advanced-search{
  /* lighter container */
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  border: 1px dashed rgba(var(--accent), .25);
  background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.08));
  box-shadow: inset 0 0 0 1px rgba(255,63,180,.04);
}

/* flatten field “cards” by default */
#advanced-search > div { display: contents; }  /* JS wrapper stays zero-cost */
#advanced-search > div > div{
  display: grid;
  grid-template-columns: 1fr;        /* mobile: label on top */
  gap: 6px;
  padding: 6px 8px;                  /* was ~10–12px */
  border-radius: 8px;
  background: transparent;
  border: 1px solid transparent;
  box-shadow: none;
}

/* show structure only when interacting */
#advanced-search > div > div:focus-within{
  background: linear-gradient(180deg, #12182a, #0e1420);
  border-color: rgba(var(--accent), .35);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.35), 0 0 0 3px rgba(var(--accent), .10);
}

/* smaller labels */
#advanced-search label{
  color: #a9b4cf;
  font-size: .82rem;                 /* was .85–.9 */
  letter-spacing: .02em;
  line-height: 1.25;
  margin: 0;
}

/* denser inputs */
#advanced-search input[type="text"]{
  font-family: 'Yu Gothic','Meiryo','Hiragino Kaku Gothic ProN','Noto Sans JP',sans-serif;
  padding: .58rem .7rem;             /* ~36–40px tall touch target */
  font-size: .95rem;                 /* was 1rem */
  border: 1px solid #3e4254;         /* thinner */
  border-radius: 3px;                /* tighter */
  background: #24263a;
}
#advanced-search input[type="text"]::placeholder { opacity: .85; }
#advanced-search input[type="text"]:focus{
  border-color: var(--accent-color);
  background: #262a46;
  box-shadow: 0 0 0 2px rgba(var(--accent), .16), 0 0 12px rgba(var(--accent), .16);
}



/* single column when narrow */
@container (max-width: 719px){
  #advanced-search{ grid-template-columns: 1fr; }
}

/* optional: micro-variant that makes it even tighter when needed
   add class="search-mode compact" to #advanced-search to activate */
#advanced-search.compact{
  gap: 8px;
  padding: 8px;
}
#advanced-search.compact input[type="text"]{
  padding: .5rem .65rem;
  font-size: .92rem;
  border-radius: 5px;
}

/*---------------------------------------------------------------
  3. RESULTS WRAPPER
----------------------------------------------------------------*/
.search-results__heading {
  font-size: clamp(1.1rem, 1vw + .7rem, 1.5rem);
  font-weight: 700; letter-spacing: .02em;
  margin: 0 0 .75rem 0;
  text-shadow: 0 0 6px rgba(0, 255, 255, .2);
  display: none;
}
.search-results__container {
  margin-top: .5rem; padding: var(--spacing-md);
  min-height: 320px;                 /* give the grid some body */
  background:
    linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.06)),
    repeating-linear-gradient(0deg,  rgba(var(--accent), .07) 0 1px, transparent 1px 36px),
    repeating-linear-gradient(90deg, rgba(255,63,180,.05) 0 1px, transparent 1px 36px);
  border: 1px solid rgba(var(--accent), .25);
  border-radius: 8px;
  overflow: hidden;
}

/*---------------------------------------------------------------
  4. RESPONSIVE TWEAKS
----------------------------------------------------------------*/
@media (max-width: 1024px) {
  /* actions stay on one line until mobile */
  .search-controls__toggle,
  .search-controls__button { height: 2.6rem; }
}
@media (max-width: 768px) {
  .search-controls__form { 
    gap: var(--spacing-md); 
    padding: var(--spacing-md);
  }
  /* stack actions full-width on mobile for easy tapping */
  .search-controls__toggle,
  .search-controls__button {
    width: 100%;
    margin-left: 0;
  }
}

@media (max-width: 768px) {
  .search-controls__form-wrapper {
    /* remove complex neon drop-shadows */
    filter: none;
    -webkit-filter: none;
  }

  .search-controls__form {
    /* remove shaped clip-path */
    clip-path: none;
    -webkit-clip-path: none;

    /* normal card styling */
    background: rgba(13, 15, 17, 0.95);
    border: 1px solid var(--accent-color);
    border-radius: 2px;

    /* subtle glow */
    box-shadow: 0 0 8px rgba(var(--accent), 0.5), 0 0 16px rgba(var(--accent), 0.5);
  }

}